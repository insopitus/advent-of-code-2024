

fn parse(input:&str){
    
}
#[derive(Debug,Clone, Copy)]
enum Direction{
    Up,
    Down,
    Left,Right
}
impl Direction{
    pub fn turn(&self)->Self{
        match self{
            Direction::Up => Self::Right,
            Direction::Down => Self::Left,
            Direction::Left => Self::Up,
            Direction::Right => Self::Down,
        }
    }
    pub fn go_alone(&self,i:usize,j:usize)->(usize,usize){
        match self{
            Direction::Up => (i,j.wrapping_sub(1)),
            Direction::Down => (i,j+1),
            Direction::Left => (i.wrapping_sub(1),j), // should do a =0 check, but a quick dirty trick does the job.
            Direction::Right => (i+1,j),
        }
    }
}
struct Matrix{
    inner:Vec<Vec<char>>
}
impl Matrix{
    pub fn from_str(str:&str)->Self{
        Self { inner: str.lines().map(|l|l.chars().collect()).collect() }
    }
    pub fn get(&self,i:usize,j:usize)->Option<char>{
        self.inner.get(j).map(|v|v.get(i).copied()).flatten()
    }
    pub fn visit(&mut self,i:usize,j:usize){
        self.inner[j][i] = 'X'
    }
    pub fn is_obstacle(&self,i:usize,j:usize)->bool{
        self.get(i, j) == Some('#')
    }
    pub fn step(&self,i:usize,j:usize,dir:Direction)->(usize,usize,Direction){
        let (ni,nj) = dir.go_alone(i, j);
        if self.is_obstacle(ni, nj){
            let new_dir = dir.turn();
            let (x,y) = new_dir.go_alone(i, j);
            (x,y,new_dir)

        }else{
            let (x,y) = dir.go_alone(i, j);
            (x,y,dir)
        }
    }
    pub fn find_start(&self)->Option<(usize,usize)>{
        for (j,row) in self.inner.iter().enumerate(){
            for (i,c) in row.iter().enumerate(){
                if *c == '^'{
                    return Some((i,j))
                }
            }
        }
        None
    }
    pub fn count(&self)->i32{
        let mut count = 0;
        for (i,row) in self.inner.iter().enumerate(){
            for (j,c) in row.iter().enumerate(){
                if *c == 'X'{
                    count+=1;
                }
            }
        }
        count
    }
    pub fn print(&self){
        for row in &self.inner{
            for c in row{
                print!("{c}");
            }
            println!();
        }
        println!()
    }
}
mod part_1{
    use crate::day6::Matrix;



    fn solve(input:&str)->i32{
        let mut matrix = Matrix::from_str(input);
        // matrix.print();
        let (mut x,mut y) = matrix.find_start().unwrap();
        let mut dir = super::Direction::Up;
        while matrix.get(x,y).is_some(){
            matrix.visit(x, y);
            // matrix.print();
            (x,y,dir) = matrix.step(x, y, dir);
        };
        matrix.count()

    }

    #[cfg(test)]
    mod test{
        use super::solve;
        #[test]
        fn example(){
            let input = super::super::input::example;
            assert_eq!(solve(input),41);
        }
        #[test]
        fn question(){
            dbg!(solve(super::super::input::actual));
        }
    }
}

mod part_2{
    use std::collections::HashMap;
    fn solve(input:&str)->i32{
        
        0

    }

    #[cfg(test)]
    mod test{
        use super::solve;
        #[test]
        fn example(){
            let input = super::super::input::example;
            assert_eq!(solve(input),31);
        }
        #[test]
        fn question(){
            

            dbg!(solve(super::super::input::actual));
        }
    }
}

mod input{
    pub const example:&str = "....#.....
.........#
..........
..#.......
.......#..
..........
.#..^.....
........#.
#.........
......#...";

    pub const actual:&str = "....#.................#......................#..........................#..................#....##..#...........#.................
...................................#...............................#......#..#...............................#....................
..........................#................#......##.....#.....................................#...............#..#...............
.......................................................................................................#..........................
...................#....#.........................#..............#.....#......................................................#...
.....#.........................................................................................................#..................
.........................................................#....................#..#............#................#..................
..............#...............#..................................................................#......#.........................
.........#.....#.......#......#.......................#.............#..#........#.......#............#.......#....#..#.......#....
........................#....#...............................................#...#.#.........................................#....
.........................#........................................................................#.....................#.........
.#..........#...#...............#..................#...#......#.................................#....................#.......#....
............................................................#......#.........................................................#....
.......................#...#..................#.#.............#......................#.............#..............................
............................................................................................................#.........#...........
....#..................###........#.............................#.#....................#..........#.....................#.........
................................................................................................#.......................#.#.......
..........................................................................#........#...#.................#.......#................
..........................#.#..#.#...............................................#..........#..............................#......
..............#........#.#...............#............................#..........#....................................#........#.#
#..................................................................................................#...........#................#.
...............................................#........................................#.................................#.......
.....#..#......#.......#..............#........#........#...........................................................#.............
.......#..........#.......#.#...........#................#.................................................#......................
....#.....#...............#....#.......#...#.............................................................#...................#....
............................................#....#.......#................................#......#......................#.....#...
.....................#...................................#....#...........................................................#.......
..#..............................#...........#...........................#.................................#......................
........#.............................##...................#.....................#................................................
................#.#.#......#...............................................#...###.........#....#.................................
.......#.............#.............#...........#..#...............................#..................................#.....#.....#
.....#...#.......#.........................................#..............................#........................#.............#
...............................................#.....#..............................................................#.............
.........#.......................................#.......................#...........#............................................
.......................#.....#.....................................................#....................................#.........
.............................#......................#.....................#..............#..#.......................#.............
......#......................................#.......#.....................#.....#...........#..........#.....................#...
..................................................#....................#.......#....#.......#...#.................................
......................................#......#........#.....#........................................#.............#..............
#......................#.#..............#.....#.........#...............................#...............................#.........
#......#...............#.........................................................................................#..#.............
.#..............................................#.................#.......#.......................................................
...#.......#.....#.............#...................................................................................#..............
..........................#........#........#.....................................#........................#..............#..#....
.......#..........#.......#...................................................#.##.....#.#.........#....#.................#.......
..##...................#.......................................#..............#.#........#........................................
#.......#..............#...........#.....#....#....#............#........#..................................#.#.........#.........
..................#.......................................................................................................#.......
............................#.........#....................#...............................#..........#...........................
.............#.....................................................................#.....#.................#......................
...#...#............#..........................#..........................................#.......................................
..#.............#.#........................#...#.......................#.........#....................##....#.....................
...........................................................................................................#.........#...#........
.............................#.#..........................................................................................#.......
....................#........................#.#......#...............#......#.............................#......................
....#...#.......#..................#..........................................................#........................#..........
.#...........#..............................................#...........................................#.........................
..............................#...........#...........................................#.........#...........................#....#
............#.......#......#....#.......................................................................#.........................
.........................................#...#..................#..................#.....................................#........
................#..................#........#.........................#...................#......................................#
............................................................#.....#........#......................................................
..............................#............#.........................................#.............#.......#..#...................
...#............#........................................................................#..................................#....#
..............................#.......#.............#.................................................#...........................
.....#.................................................#..........#...............................#..##..........................#
.............#.........................................................#.............................#..#..............#........#.
....................#...............#................................................................................#....#......#
........#....#..#...........................................................................#................#..............#.....
....#......................#...............#..........#......#.........#..^....#..........#..................#.......#............
...........................#.#...................................................#...............................#................
#..#.........................................................#.....#........................#.....................................
.#.#....#.......................................#......#..........#................#..#...........................................
...#.....#..........#...................#.......#............................#....................................................
.............#......................................................#............#.....................#.....................#....
...................#.............................................................................................#................
...................#.....#...................................................................................................#....
................#............#......................#.......#..................#..#.....................#..............#........#.
#....#...................................................................#.......##....#..........#...............................
.........................................#............#......#.......................#........#..............#.#..................
.##........#.....#...........................................................................................#..............#.....
#...........................................................#.......#....#......#..#...................................#..#.#.....
.............#........................................#...............................#...........................................
......................#..................................................................#..................................#.....
...#.#........................................#.................................................................................#.
.............#.......................#............................#.#................................#.......#..#...........#.....
...#..#...............................................................................#................#..........................
.......#.............................#............#..#........#.....#.........................#..................#................
......#...............................................................................##.................................#....#...
........#..................#.......................................................................#......#..........#............
...........#.......#........#..........................................#........#..............#.................#.........#......
...................#..............................#...............................#.....................#.....#...................
.............#..#..................#.#..#.....#..#..........................................................................#.....
..............................#...................................................#.......................#..............#........
.......#......................#.............................#...........................#.....#...#.................#........#....
.........#.......#....##..........................................................................................................
........................................................................#......................#..................................
.......................#..........##.#................................................#..#.....#......#......#.................#..
......................................#......................................................................#....................
.....................................#....#...............................................#...#.....#.......#...#...........#.....
...................#..#................................................................................#..........................
..............#.................#..............................#..............#...........#.#..................#...#.............#
................#..#......#.........................#.....#.....#..............#..#.........................................#.....
.....#.........................#........................................#.....#.......#...........#...................#...........
......#....................##......................................................................................#..............
............................................................................###...............................#...................
#..................................#......#..............................................................................#.......#
.....#...................#.....#............................................................#.....................#...#...........
.......#......#........................#.....................#.#..##............#......#.................#.....................#..
.....#..............#.................#........#..................#..#..........................##.....#..#...................#...
........#................#................#...........#.........................................#....................#............
.........#.........#....#................#........#........#...............#....#.................................................
...........#...#............#..................#.............................#.#..#....................#.#........................
.#............#..#..#................#.#................................................................##.............#..........
...........#.......................#.........................................................#....................................
..#..........................#...........#......#................................#.#..............................................
............................................................#..................#...........#.....##.................#.............
....#.........#............................##..........................................#.....#....#..........#....................
..................#..............#........#........#....................#..............#....................#.....................
....#...................................#.....................................................#.............#...................#.
.........#...........#...#.............................#.............##..#................................................#.#.....
............................##..............#................#..#........................................#....................#...
.............................#.#......................................................##.....#..................................#.
.............................................................................#..................#...#.................#...........
........................#...........#..................#......#...................................................................
.....#.......................#......#................#............#..................#.................................#..........
#..........#...................................................................#...................#...#...............#..........
....................#............................................#...............#........................##....#..#..............
.#.....#............................#...............#.#.#..........................#.........#..............#.....................
.............................#....................................#..#......#........................#............................";
}